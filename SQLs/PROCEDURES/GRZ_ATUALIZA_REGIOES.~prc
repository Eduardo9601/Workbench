CREATE OR REPLACE PROCEDURE GRZ_ATUALIZA_REGIOES AS

  /* INFORME 1 PARA SIM E 0 PARA NÃO */

  --WATUALIZANL     NUMBER(2) := 1;
  WATUALIZAFOLHA NUMBER(2) := 1;
  --WATUALIZAVENDAS NUMBER(2) := 1;

  /* CURSOR PRINCIPAL, BUSCA AS LOJAS DE CADA GRUPO*/
  /* INFORME OS GRUPOS DE QUEBRAS ATUALIZADOS*/

  CURSOR C1 IS
    SELECT A.*
      FROM NL.GE_GRUPOS_UNIDADES@NLGRZ A
     WHERE A.COD_GRUPO IN
           (8701, 8702, 8703, 8704, 8705, 8706, 8707, 8708, 8709, 8710, 8711, 8712, 8713, 8714, 8715, 8716, 8717, 8718, 8719, 8720, 8721, 8722, 8723) --essas 3 últimas é por precaução caso venham existir futuramente
    -- AND A.COD_UNIDADE = 4
     ORDER BY A.COD_UNIDADE;
  R1 C1 %ROWTYPE;

BEGIN
  OPEN C1;
  FETCH C1
    INTO R1;
  WHILE C1%FOUND LOOP
  
    IF WATUALIZAFOLHA = 1 THEN
    
      UPDATE PE0002
         SET VALOR = R1.COD_GRUPO
       WHERE COD_CAMPO = 1
         AND COD_PESSOA =
             (SELECT B.COD_PESSOA
                FROM RHFP0401 A, RHFP0400 B
               WHERE A.COD_ORGANOGRAMA = B.COD_ORGANOGRAMA
                 AND A.COD_ORGANOGRAMA_SUB = 8
                 AND A.EDICAO_ORG = R1.COD_UNIDADE);
    END IF;
  
    FETCH C1
      INTO R1;
  END LOOP;
  CLOSE C1;
END GRZ_ATUALIZA_REGIOES;
/
