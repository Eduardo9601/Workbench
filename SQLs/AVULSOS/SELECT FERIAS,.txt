--==VERSÃO COM DATA FIXA NO FILTRO

SELECT A.COD_CONTRATO,
       B.DES_PESSOA,
       B.COD_UNIDADE,
       B.DES_UNIDADE,
       A.DATA_INICIO_PERIODO,
       A.DATA_FIM_PERIODO,
       CASE
         WHEN A.DATA_FIM_PERIODO <= SYSDATE THEN
          1
         ELSE
          0
       END AS IND_PER_ATIVO,
       CASE
         WHEN A.DATA_ENCERRAMENTO IS NOT NULL THEN
          'GOZADAS'
         WHEN A.DATA_FIM_PERIODO <= SYSDATE THEN
          'VENCIDO'
         ELSE
          'A VENCER'
       END AS STATUS_PERIODO,
       TRUNC(MONTHS_BETWEEN(SYSDATE, A.DATA_FIM_PERIODO)) AS QTD_MESES_FIM_PERIODO,
       CASE
         WHEN A.DATA_ENCERRAMENTO IS NOT NULL THEN
          'FÉRIAS JÁ GOZADAS'
         WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, A.DATA_FIM_PERIODO)) >= 10 THEN
          'PERÍODO COM MAIS DE 10 MESES DE VENCIMENTO, 
             FAVOR PROGRAMAR AS FÉRIAS ANTES DO VENCIMENTO DO PRÓXIMO PERÍODO, 
             CASO CONTRÁRIO, A EMPRESA SOFRERÁ MULTA INDENIZATÓRIA'
         WHEN A.DATA_FIM_PERIODO > SYSDATE THEN
          'PERÍODO AINDA NO PRAZO'
         ELSE
          'PERÍODO VENCIDO, MAS AINDA NO LIMITE DE 10 MESES'
       END AS AVISO_VENCIMENTO,
       ' Rerefência: ' || TO_DATE('01/01/2024', 'DD/MM/YYYY') || ' à ' ||
       TO_DATE('30/06/2024', 'DD/MM/YYYY') AS REFERENCIA
  FROM RHFP0325 A
 INNER JOIN V_DADOS_COLAB_AVT B ON A.COD_CONTRATO = B.COD_CONTRATO
 WHERE A.DATA_FIM_PERIODO BETWEEN TO_DATE('01/01/2024', 'DD/MM/YYYY') AND
       TO_DATE('30/06/2024', 'DD/MM/YYYY')
   AND A.DATA_FIM_PERIODO <= SYSDATE
   AND B.STATUS = 0
   AND B.COD_EMP = '008'
 ORDER BY B.COD_UNIDADE ASC

 

--==VERSÃO COM FILTRO DE DATA INFORMADA
 
SELECT A.COD_CONTRATO || ' - ' || B.DES_PESSOA AS PESSOA,
       B.COD_UNIDADE,
       B.DES_UNIDADE,
       'Período de: ' || A.DATA_INICIO_PERIODO || ' à ' || A.DATA_FIM_PERIODO AS PERIODO_FERIAS,
       CASE
         WHEN A.DATA_FIM_PERIODO <= SYSDATE THEN
          1
         ELSE
          0
       END AS IND_PER_ATIVO,
       CASE
         WHEN A.DATA_ENCERRAMENTO IS NOT NULL THEN
          'GOZADAS'
         WHEN A.DATA_FIM_PERIODO <= SYSDATE THEN
          'VENCIDO'
         ELSE
          'A VENCER'
       END AS STATUS_PERIODO,
       TRUNC(MONTHS_BETWEEN(SYSDATE, A.DATA_FIM_PERIODO)) AS QTD_MESES_FIM_PERIODO,
       CASE
         WHEN A.DATA_ENCERRAMENTO IS NOT NULL THEN
          'FÉRIAS JÁ GOZADAS'
         WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, A.DATA_FIM_PERIODO)) >= 10 THEN
          'PERÍODO COM MAIS DE 10 MESES DE VENCIMENTO, 
           FAVOR PROGRAMAR AS FÉRIAS ANTES DO VENCIMENTO DO PRÓXIMO PERÍODO, 
           CASO CONTRÁRIO, A EMPRESA SOFRERÁ MULTA INDENIZATÓRIA'
         WHEN A.DATA_FIM_PERIODO > SYSDATE THEN
          'PERÍODO AINDA NO PRAZO'
         ELSE
          'PERÍODO VENCIDO, MAS AINDA NO LIMITE DE 10 MESES'
       END AS AVISO_VENCIMENTO,
       ' Rerefência: ' || TO_CHAR(:DATA_INICIO, 'DD/MM/YYYY') || ' à ' ||
       TO_CHAR(:DATA_FIM, 'DD/MM/YYYY') AS REFERENCIA
  FROM RHFP0325 A
 INNER JOIN V_DADOS_COLAB_AVT B ON A.COD_CONTRATO = B.COD_CONTRATO
 WHERE A.DATA_FIM_PERIODO BETWEEN TO_CHAR(:DATA_INICIO, 'DD/MM/YYYY') AND
       TO_CHAR(:DATA_FIM, 'DD/MM/YYYY')
   AND A.DATA_FIM_PERIODO <= SYSDATE
   AND B.STATUS = 0
   AND B.COD_EMP = '008'
 ORDER BY B.COD_UNIDADE ASC
