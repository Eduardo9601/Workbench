DROP SYNONYM SELORG_FPRE0021A;
  
CREATE TABLE SELORG_FPRE0021A 
( 
 COD_ORGANOGRAMA     NUMBER  (15) NOT NULL PRIMARY KEY, 
 NOME_ORGANOGRAMA    VARCHAR2(50) NULL,  
 NOME_ORGANOGRAMA_E  VARCHAR2(70) NULL,  
 NOME_ORGANOGRAMA_C  VARCHAR2(70) NULL,  
 COD_ORGANOGRAMA_SUB NUMBER  (15) NULL,  
 EDICAO              VARCHAR2(80) NULL,  
 EDI1                VARCHAR2(10) NULL,  
 EDI2                VARCHAR2(10) NULL,  
 EDI3                VARCHAR2(10) NULL,  
 EDI4                VARCHAR2(10) NULL,  
 EDI5                VARCHAR2(10) NULL,  
 EDI6                VARCHAR2(10) NULL,  
 EDI7                VARCHAR2(10) NULL,  
 EDI8                VARCHAR2(10) NULL,  
 COD1                NUMBER  (15) NULL,  
 COD2                NUMBER  (15) NULL,  
 COD3                NUMBER  (15) NULL,  
 COD4                NUMBER  (15) NULL,  
 COD5                NUMBER  (15) NULL,  
 COD6                NUMBER  (15) NULL,  
 COD7                NUMBER  (15) NULL,  
 COD8                NUMBER  (15) NULL,  
 NOME1               VARCHAR2(50) NULL,  
 NOME2               VARCHAR2(50) NULL,  
 NOME3               VARCHAR2(50) NULL,  
 NOME4               VARCHAR2(50) NULL,  
 NOME5               VARCHAR2(50) NULL,  
 NOME6               VARCHAR2(50) NULL,  
 NOME7               VARCHAR2(50) NULL,  
 NOME8               VARCHAR2(50) NULL, 
 IND_SEL             NUMBER  (1)  NOT NULL );
 
 TRUNCATE TABLE SELORG_FPRE0021A;


INSERT INTO SELORG_FPRE0021A 
SELECT RHFP0401.COD_ORGANOGRAMA, 
       RHFP0400.NOME_ORGANOGRAMA,
       RHFP0401.EDICAO_ORG || '' - '' || RHFP0400.NOME_ORGANOGRAMA AS NOME_ORGANOGRAMA_E, 
       RHFP0401.COD_ORGANOGRAMA || '' - '' || RHFP0400.NOME_ORGANOGRAMA AS NOME_ORGANOGRAMA_C,
       RHFP0401.COD_ORGANOGRAMA_SUB, 
       SUBSTR(RHYF0002(RHFP0400.COD_ORGANOGRAMA,RHFP0400.COD_NIVEL_ORG,:DATA_REFERENCIA),1,80) AS EDICAO, 
       RHFP0401.EDICAO_NIVEL1 AS EDI1, 
       RHFP0401.EDICAO_NIVEL2 AS EDI2, 
       RHFP0401.EDICAO_NIVEL3 AS EDI3, 
       RHFP0401.EDICAO_NIVEL4 AS EDI4, 
       RHFP0401.EDICAO_NIVEL5 AS EDI5, 
       RHFP0401.EDICAO_NIVEL6 AS EDI6, 
       RHFP0401.EDICAO_NIVEL7 AS EDI7, 
       RHFP0401.EDICAO_NIVEL8 AS EDI8, 
       RHFP0401.COD_NIVEL1 AS COD1, 
       RHFP0401.COD_NIVEL2 AS COD2, 
       RHFP0401.COD_NIVEL3 AS COD3, 
       RHFP0401.COD_NIVEL4 AS COD4, 
       RHFP0401.COD_NIVEL5 AS COD5, 
       RHFP0401.COD_NIVEL6 AS COD6, 
       RHFP0401.COD_NIVEL7 AS COD7, 
       RHFP0401.COD_NIVEL8 AS COD8, 
       NOMEN1.NOME_ORGANOGRAMA AS NOME1,
       NOMEN2.NOME_ORGANOGRAMA AS NOME2,
       NOMEN3.NOME_ORGANOGRAMA AS NOME3,
       NOMEN4.NOME_ORGANOGRAMA AS NOME4,
       NOMEN5.NOME_ORGANOGRAMA AS NOME5,
       NOMEN6.NOME_ORGANOGRAMA AS NOME6,
       NOMEN7.NOME_ORGANOGRAMA AS NOME7,
       NOMEN8.NOME_ORGANOGRAMA AS NOME8,
       0 AS IND_SEL 
FROM RHFP0401 RHFP0401, 
     RHFP0400 NOMEN1, 
     RHFP0400 NOMEN2, 
     RHFP0400 NOMEN3, 
     RHFP0400 NOMEN4, 
     RHFP0400 NOMEN5, 
     RHFP0400 NOMEN6, 
     RHFP0400 NOMEN7, 
     RHFP0400 NOMEN8, 
     RHFP0400 RHFP0400 
 WHERE RHFP0401.COD_ORGANOGRAMA = RHFP0400.COD_ORGANOGRAMA 
   AND RHFP0401.COD_NIVEL1 = NOMEN1.COD_ORGANOGRAMA(+) 
   AND RHFP0401.COD_NIVEL2 = NOMEN2.COD_ORGANOGRAMA(+) 
   AND RHFP0401.COD_NIVEL3 = NOMEN3.COD_ORGANOGRAMA(+) 
   AND RHFP0401.COD_NIVEL4 = NOMEN4.COD_ORGANOGRAMA(+) 
   AND RHFP0401.COD_NIVEL5 = NOMEN5.COD_ORGANOGRAMA(+) 
   AND RHFP0401.COD_NIVEL6 = NOMEN6.COD_ORGANOGRAMA(+) 
   AND RHFP0401.COD_NIVEL7 = NOMEN7.COD_ORGANOGRAMA(+) 
   AND RHFP0401.COD_NIVEL8 = NOMEN8.COD_ORGANOGRAMA(+) 
   AND :DATA_REFERENCIA BETWEEN RHFP0401.DATA_INICIO AND RHFP0401.DATA_FIM; 

SELECT * FROM SELORG_FPRE0021A