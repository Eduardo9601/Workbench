/*SQL EXTRAIDO DE SELEÇÃO DA FOLHA*/

SELECT CON_STAAFA.STATUS_AFASTAMENTO
,CON_AFAST.COD_CAUSA_AFAST
,CON_AFAST.NOME_CAUSA_AFAST
,CON_AFAST.DATA_INICIO
,CON_AFAST.DATA_FIM
,CON_AFAST.HORAS_AFASTAMENTO
,CON_CON.COD_CONTRATO
From RHFP0300 RHFP0300
,  ( 
SELECT         
  RHFP0300.COD_CONTRATO,
  RHFP0300.COD_FUNC,
  RHFP0300.DATA_INICIO,
  RHFP0300.DATA_FIM, 
  RHFP0300.COD_CAUSA_DEMISSAO,
  RHFP0102.NOME_CAUSA_DEMISSAO,
  RHFP0102.COD_CAGED AS COD_CAGED_DEMISSAO, 
  RHFP0102.COD_SAQUE,
  RHFP0300.COD_CLASSE_CONTRATO,
  RHFP0239.NOME_CLASSE_CONTRATO,
  RHFP0300.COD_VINCULO_EMPREG,
  RHFP0110.NOME_VINCULO_EMPREG,
  RHFP0300.COD_TIPO_ADMISSAO,
  RHFP0114.NOME_TIPO_ADMISSAO,
  RHFP0114.COD_CAGED AS COD_CAGED_ADMISSAO,
  RHFP0300.COD_OPC_PGTO,
  RHFP0112.NOME_OPCAO_PGTO,
  RHFP0300.COD_FORMA_PGTO,
  RHFP0111.NOME_FORMA_PGTO,
  RHFP0300.CHAVE_PIX,
  RHFP0300.TIPO_PIX,
  CASE WHEN RHFP0300.TIPO_PIX = 'C' THEN 'CPF'
       WHEN RHFP0300.TIPO_PIX = 'T' THEN 'TELEFONE'
       WHEN RHFP0300.TIPO_PIX = 'E' THEN 'e-MAIL'
       WHEN RHFP0300.TIPO_PIX = 'A' THEN 'Código Aleatório'
       ELSE NULL END AS NOME_TIPO_PIX,
  RHFP0300.COD_BCO_PGTO,
  BANCO_PGTO.COD_FEBRABAN AS COD_FEBRABAN_PGTO, 
  PESSOA_BCO_PGTO.NOME_PESSOA AS NOME_BCO_PGTO,
  RHFP0300.COD_AGE_PGTO,
  AGENCIA_PGTO.DIGITO AS DIGITO_AGENCIA_PGTO,
  PESSOA_AGE_PGTO.NOME_PESSOA AS NOME_AGE_PGTO,
  RHFP0300.NRO_CONTA_PGTO, 
  trim(substr(trim(RHFP0300.nro_conta_pgto),1,length(trim
(RHFP0300.nro_conta_pgto))-1)) as nro_conta_pagamento,
  trim(substr(trim(RHFP0300.nro_conta_pgto),length(trim
(RHFP0300.nro_conta_pgto)),1)) as digito_conta_pagamento,
  RHFP0300.DATA_OPCAO_FGTS,
  RHFP0300.COD_BCO_FGTD,
  BANCO_FGTS.COD_FEBRABAN AS COD_FEBRABAN_FGTS, 
  PESSOA_BCO_FGTS.NOME_PESSOA AS NOME_BCO_FGTS,
  RHFP0300.COD_AGE_FGTS,
  PESSOA_AGE_FGTS.NOME_PESSOA AS NOME_AGE_FGTS,
  RHFP0300.NRO_CONTA_FGTS,
  RHFP0300.COD_TIPO_CONTRATO,
  RHFP0116.NOME_TIPO_CONTRATO,
  RHFP0116.DURACAO_CONTRATO,
  RHFP0116.ATUALIZA_AUTOMATICO,
  RHFP0116.NOVO_TIPO_CONTRATO,
  RHFP0300.MAO_OBRA,
  RHFP0300.COD_SITUACAO,
  RHFP0113.NOME_SITUACAO,
  RHFP0300.COD_CATEGORIA_TRAB,
  RHFP0128.NOME_CATEGORIA_TRAB,
  RHFP0128.COD_ESOCIAL AS COD_CATEGORIA_ESOCIAL,
  RHFP0128.DESC_ESOCIAL AS NOME_CATEGORIA_ESOCIAL,
  RHFP0300.COD_CLASSE_CONTRIB,
  RHFP0804.VALOR_CONTRIBUICAO,
  RHFP0300.IND_VINCULO_MULT,
  RHFP0300.IND_AGENTES_NOCIVOS,
  RHFP0300.IND_CONT_PREV,
  RHFP0300.DATA_AVANCO,
  :DATA_REFERENCIA AS DATA_REFERENCIA,
  TO_NUMBER(TO_CHAR(RHFP0300.DATA_AVANCO,'DD'),'99') AS DIA_AVANCO, 
  TO_NUMBER(TO_CHAR(RHFP0300.DATA_AVANCO,'MM'),'99') AS MES_AVANCO, 
  TO_NUMBER(TO_CHAR(RHFP0300.DATA_AVANCO,'YYYY'),'9999') AS ANO_AVANCO,
  TO_NUMBER(TO_CHAR(RHFP0300.DATA_INICIO,'DD'),'99') AS DIA_ADMISSAO, 
  TO_NUMBER(TO_CHAR(RHFP0300.DATA_INICIO,'MM'),'99') AS MES_ADMISSAO, 
  TO_NUMBER(TO_CHAR(RHFP0300.DATA_INICIO,'YYYY'),'9999') AS 
ANO_ADMISSAO,
  0 AS CHECK_UNIBANCO,
  RHAF1112.IND_ESPELHO,
  RHAF1112.IND_FREQUENCIA,
  RHAF1112.IND_HORARIO_AUTO,
  RHAF1112.IND_OCORRENCIAS,
  RHAF1112.IND_REFEITORIO,
  RHCS0196.DATA_ADESAO,
  NVL(RHCS0196.IND_ADERIU, CASE WHEN RHFP0300.DATA_INICIO >= TO_DATE
('01/01/2012','DD/MM/YYYY') THEN 'A' ELSE 'X' END) AS IND_ADERIU,
  RHCS0196.NRO_PROTOCOLO,
  RHFP0300.DATA_REINTEGRACAO,
  RHFP0321.QTD_HORBAS_DIA,
  RHFP0321.QTD_HORBAS_MES,
  RHFP0321.QTD_HORBAS_SEM
FROM PESSOA PESSOA_BCO_PGTO,
     PESSOA PESSOA_AGE_PGTO,
     PESSOA PESSOA_BCO_FGTS,
     PESSOA PESSOA_AGE_FGTS,
     RHFP0300 RHFP0300,
     BANCO BANCO_PGTO,
     AGENCIA AGENCIA_PGTO,
     BANCO BANCO_FGTS,
     AGENCIA AGENCIA_FGTS,
     RHFP0102 RHFP0102,
     RHFP0239 RHFP0239,
     RHFP0110 RHFP0110, 
     RHFP0114 RHFP0114,
     RHFP0112 RHFP0112,
     RHFP0111 RHFP0111,
     RHFP0116 RHFP0116,
     RHFP0113 RHFP0113,
     RHFP0128 RHFP0128,
     RHFP0804 RHFP0804,
     RHAF1112 RHAF1112,
     RHCS0196 RHCS0196,
     RHFP0307 RHFP0307,
     RHFP0321 RHFP0321
WHERE     RHFP0300.COD_CAUSA_DEMISSAO = RHFP0102.COD_CAUSA_DEMISSAO(+)
      AND RHFP0300.COD_CLASSE_CONTRATO = RHFP0239.COD_CLASSE_CONTRATO(+)
      AND RHFP0300.COD_VINCULO_EMPREG = RHFP0110.COD_VINCULO_EMPREG(+)
      AND RHFP0300.COD_TIPO_ADMISSAO = RHFP0114.COD_TIPO_ADMISSAO(+)
      AND RHFP0300.COD_OPC_PGTO = RHFP0112.COD_OPCAO_PGTO(+)
      AND RHFP0300.COD_FORMA_PGTO = RHFP0111.COD_FORMA_PGTO(+)
      AND RHFP0300.COD_BCO_PGTO = BANCO_PGTO.COD_BANCO(+)
      AND BANCO_PGTO.COD_PESSOA = PESSOA_BCO_PGTO.COD_PESSOA(+)
      AND RHFP0300.COD_BCO_PGTO = AGENCIA_PGTO.COD_BANCO(+)
      AND RHFP0300.COD_AGE_PGTO = AGENCIA_PGTO.COD_AGENCIA(+)
      AND AGENCIA_PGTO.COD_PESSOA = PESSOA_AGE_PGTO.COD_PESSOA(+)
      AND RHFP0300.COD_BCO_FGTD = BANCO_FGTS.COD_BANCO(+)
      AND BANCO_FGTS.COD_PESSOA = PESSOA_BCO_FGTS.COD_PESSOA(+)
      AND RHFP0300.COD_BCO_FGTD = AGENCIA_FGTS.COD_BANCO(+)
      AND RHFP0300.COD_AGE_FGTS = AGENCIA_FGTS.COD_AGENCIA(+)
      AND AGENCIA_FGTS.COD_PESSOA = PESSOA_AGE_FGTS.COD_PESSOA(+)
      AND RHFP0300.COD_TIPO_CONTRATO = RHFP0116.COD_TIPO_CONTRATO(+) 
      AND RHFP0300.COD_SITUACAO = RHFP0113.COD_SITUACAO(+)
      AND RHFP0300.COD_CATEGORIA_TRAB = RHFP0128.COD_CATEGORIA_TRAB(+)
      AND RHFP0300.COD_CLASSE_CONTRIB = RHFP0804.COD_CLASSE_CONTRIB(+)
      AND RHFP0300.COD_CONTRATO = RHAF1112.COD_CONTRATO(+)
      AND :DATA_REFERENCIA BETWEEN RHAF1112.DATA_INICIO(+) 
      AND RHAF1112.DATA_FIM(+)
      AND RHFP0300.COD_CONTRATO = RHCS0196.COD_CONTRATO(+)
      AND RHFP0300.COD_CONTRATO = RHFP0307.COD_CONTRATO(+)
      AND :DATA_REFERENCIA BETWEEN RHFP0307.DATA_INICIO(+) AND 
RHFP0307.DATA_FIM(+)
      AND RHFP0307.COD_HORAS_BASE = RHFP0321.COD_HORAS_BASE(+)
 ) CON_CON
,( 
SELECT RHFP0300.COD_CONTRATO,
       NVL(RHFP0306.COD_CAUSA_AFAST,0) AS  STATUS_AFASTAMENTO
  FROM RHFP0306 RHFP0306,
       RHFP0300 RHFP0300 
 WHERE RHFP0300.COD_CONTRATO = RHFP0306.COD_CONTRATO(+) 
   AND :DATA_REFERENCIA BETWEEN RHFP0306.DATA_INICIO(+) AND RHFP0306.DATA_FIM(+)
 ) CON_STAAFA
,( 
SELECT  
  RHFP0306.COD_CONTRATO, 
  RHFP0306.DATA_INICIO,  
  RHFP0306.DATA_FIM,     
  RHFP0306.COD_CAUSA_AFAST,  
  RHFP0306.COD_MOTIVO,        
  RHFP0306.HORAS_AFASTAMENTO, 
  RHFP0306.DATA_INICIO_FRE,   
  RHFP0306.DATA_FIM_FRE,    
  RHFP0323.NOME_MOTIVO,
  RHFP0323.COD_TIPO_MOTIVO,
  RHFP0115.NOME_TIPO_MOTIVO,
  RHFP0100.NOME_CAUSA_AFAST,
  RHFP0100.NUM_DIAS,
  RHYF0117(RHFP0306.HORAS_AFASTAMENTO) AS HORAS_AFASTAMENTO_DEC,
  RHFP0100.COD_MOVIMENTO_TRAB,
  RHFP0121.NOME_MOVIMENTO_TRAB,
  (DECODE(RHFP0306.DATA_FIM,TO_DATE('31/12/2999'),TRUNC(SYSDATE),RHFP0306.DATA_FIM) - RHFP0306.DATA_INICIO + 1) DIAS_AFASTADO,
  PESSOA.NOME_PESSOA AS NOME_MEDICO,
  RHFP0306.COD_CID_10  
 FROM RHFP0306 RHFP0306,   
      RHFP0100 RHFP0100,
      RHFP0323 RHFP0323,
      RHFP0115 RHFP0115,
      RHFP0121 RHFP0121,
      PESSOA PESSOA  
WHERE RHFP0306.COD_CAUSA_AFAST    = RHFP0100.COD_CAUSA_AFAST
  AND RHFP0306.COD_MOTIVO         = RHFP0323.COD_MOTIVO(+)
  AND RHFP0323.COD_TIPO_MOTIVO    = RHFP0115.COD_TIPO_MOTIVO(+)
  AND RHFP0100.COD_MOVIMENTO_TRAB = RHFP0121.COD_MOVIMENTO_TRAB(+)       
  AND :DATA_REFERENCIA BETWEEN RHFP0306.DATA_INICIO AND RHFP0306.DATA_FIM
  AND RHFP0306.COD_PESSOA         = PESSOA.COD_PESSOA(+) 
 ) CON_AFAST
Where RHFP0300.COD_CONTRATO = CON_CON.COD_CONTRATO(+)
 and RHFP0300.COD_CONTRATO = CON_AFAST.COD_CONTRATO(+)
 and RHFP0300.COD_CONTRATO = CON_STAAFA.COD_CONTRATO(+)
AND ( RHFP0300.COD_CONTRATO IN (SELECT COD_CONTRATO FROM RHFP0300 WHERE COD_CONTRATO = 389622) )