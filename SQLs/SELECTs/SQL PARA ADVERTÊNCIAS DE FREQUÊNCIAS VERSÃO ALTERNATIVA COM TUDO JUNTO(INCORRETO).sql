SELECT RHFP0401.EDICAO_ORG,
       RHFP0400.NOME_ORGANOGRAMA,
       TO_CHAR(RHAF1123.DATA_OCORRENCIA, 'MM/YYYY') AS MES_OCORRENCIA,
       RHAF1123.ORIGEM,
       TO_CHAR(SUM(CASE 
           WHEN ROUND(RHAF1123.NUM_HORAS, 2) > 2 AND RHAF1123.COD_OCORRENCIA IN
               (203, 204, 207, 208, 209, 210, 211, 212, 213, 214, 2022, 2023, 2026, 2029, 2036, 2041, 2043) THEN RHAF1123.NUM_HORAS
           ELSE 0 END), 'FM9900') || ':' ||
       TO_CHAR(MOD(SUM(CASE 
           WHEN ROUND(RHAF1123.NUM_HORAS, 2) > 2 AND RHAF1123.COD_OCORRENCIA IN
               (203, 204, 207, 208, 209, 210, 211, 212, 213, 214, 2022, 2023, 2026, 2029, 2036, 2041, 2043) THEN (RHAF1123.NUM_HORAS - TRUNC(RHAF1123.NUM_HORAS)) * 60
           ELSE 0 END), 60), 'FM00') AS HORAS_EXTRAS_COM_MARCACAO,
       TO_CHAR(SUM(CASE 
           WHEN RHAF1145.CARGA_HORARIA BETWEEN 195 AND 220 AND RHAF1123.COD_OCORRENCIA = 2048 THEN RHAF1123.NUM_HORAS
           ELSE 0 END), 'FM9900') || ':' ||
       TO_CHAR(MOD(SUM(CASE 
           WHEN RHAF1145.CARGA_HORARIA BETWEEN 195 AND 220 AND RHAF1123.COD_OCORRENCIA = 2048 THEN (RHAF1123.NUM_HORAS - TRUNC(RHAF1123.NUM_HORAS)) * 60
           ELSE 0 END), 60), 'FM00') AS INTERVALOS_JORNADAS,
       TO_CHAR(SUM(CASE 
           WHEN RHAF1123.ORIGEM = 'I' THEN RHAF1123.NUM_HORAS
           ELSE 0 END), 'FM9900') || ':' ||
       TO_CHAR(MOD(SUM(CASE 
           WHEN RHAF1123.ORIGEM = 'I' THEN (RHAF1123.NUM_HORAS - TRUNC(RHAF1123.NUM_HORAS)) * 60
           ELSE 0 END), 60), 'FM00') AS OCORRENCIAS_INFORMADAS,
       TO_CHAR(SUM(CASE 
           WHEN RHAF1123.COD_OCORRENCIA = 2 AND RHAF1123.NUM_HORAS > 10 THEN RHAF1123.NUM_HORAS
           ELSE 0 END), 'FM9900') || ':' ||
       TO_CHAR(MOD(SUM(CASE 
           WHEN RHAF1123.COD_OCORRENCIA = 2 AND RHAF1123.NUM_HORAS > 10 THEN (RHAF1123.NUM_HORAS - TRUNC(RHAF1123.NUM_HORAS)) * 60
           ELSE 0 END), 60), 'FM00') AS HORAS_EXTRAS,
       TO_CHAR(SUM(CASE 
           WHEN RHAF1145.CARGA_HORARIA BETWEEN 165 AND 180 AND RHAF1123.COD_OCORRENCIA = 2049 THEN RHAF1123.NUM_HORAS
           ELSE 0 END), 'FM9900') || ':' ||
       TO_CHAR(MOD(SUM(CASE 
           WHEN RHAF1145.CARGA_HORARIA BETWEEN 165 AND 180 AND RHAF1123.COD_OCORRENCIA = 2049 THEN (RHAF1123.NUM_HORAS - TRUNC(RHAF1123.NUM_HORAS)) * 60
           ELSE 0 END), 60), 'FM00') AS INTERVALOS_JORNADAS_2,
       TO_CHAR(SUM(CASE 
           WHEN RHAF1123.COD_OCORRENCIA = 901 THEN RHAF1123.NUM_HORAS
           ELSE 0 END), 'FM9900') || ':' ||
       TO_CHAR(MOD(SUM(CASE 
           WHEN RHAF1123.COD_OCORRENCIA = 901 THEN (RHAF1123.NUM_HORAS - TRUNC(RHAF1123.NUM_HORAS)) * 60
           ELSE 0 END), 60), 'FM00') AS OCORRENCIAS_INTRAJORNADA
  FROM RHAF1123 RHAF1123
  JOIN RHAF1129 RHAF1129 ON RHAF1123.COD_OCORRENCIA =
                            RHAF1129.COD_OCORRENCIA
  LEFT JOIN RHAF1108 RHAF1108 ON RHAF1123.COD_CONTRATO =
                                 RHAF1108.COD_CONTRATO
  JOIN RHAF1119 ON RHAF1123.COD_CONTRATO = RHAF1119.COD_CONTRATO
  JOIN RHAF1145 ON RHAF1119.COD_TURNO = RHAF1145.COD_TURNO
  JOIN RHFP0310 RHFP0310 ON RHAF1123.COD_CONTRATO = RHFP0310.COD_CONTRATO
  JOIN RHFP0400 RHFP0400 ON RHFP0310.COD_ORGANOGRAMA =
                            RHFP0400.COD_ORGANOGRAMA
  JOIN RHFP0401 RHFP0401 ON RHFP0400.COD_ORGANOGRAMA =
                            RHFP0401.COD_ORGANOGRAMA
  LEFT JOIN RHAF1138 RHAF1138 ON RHAF1129.COD_MOTIVO_OCO =
                                 RHAF1138.COD_MOTIVO_OCO
 WHERE RHAF1123.DATA_OCORRENCIA BETWEEN '01/05/2023' AND '31/05/2023'
   AND RHAF1123.DATA_OCORRENCIA BETWEEN RHAF1108.DATA_INICIO AND
       RHAF1108.DATA_FIM
   AND RHFP0310.DATA_FIM = '31/12/2999'
   AND RHFP0401.COD_NIVEL2 = 8
   AND RHFP0401.EDICAO_NIVEL3 NOT IN ('013', '001')
 GROUP BY RHFP0401.EDICAO_ORG,
          RHFP0400.NOME_ORGANOGRAMA,
          TO_CHAR(RHAF1123.DATA_OCORRENCIA, 'MM/YYYY'),
          RHAF1123.ORIGEM
 ORDER BY RHFP0401.EDICAO_ORG ASC;