--SQL QUE BUSCA OS GERENTES DAS LOJAS

SELECT DISTINCT CLH.COD_CONTRATO,
                PE.NOME_PESSOA,
                CLH.COD_CLH,
                CLH2.NOME_CLH,
                ORG3.EDICAO_ORG,
                ORG2.NOME_ORGANOGRAMA
  FROM RHFP0340 CLH,
       RHFP0300 CT,
       RHFP0306 AF,
       RHFP0500 CLH2,
       PESSOA   PE,
       RHFP0310 ORG,
       RHFP0400 ORG2,
       RHFP0401 ORG3
 WHERE CLH.COD_CONTRATO = CT.COD_CONTRATO
   AND CLH2.COD_CLH = CLH.COD_CLH
   AND PE.COD_PESSOA = CT.COD_FUNC
   AND ORG.COD_CONTRATO = CLH.COD_CONTRATO
   AND ORG2.COD_ORGANOGRAMA = ORG.COD_ORGANOGRAMA
   AND ORG3.COD_ORGANOGRAMA = ORG2.COD_ORGANOGRAMA
   AND AF.COD_CONTRATO = CT.COD_CONTRATO
   AND CLH.COD_CLH IN
       ('77', '78', '79', '80', '81', '86', '87', '88', '90', '184', '185',
        '186', '188', '189', '190', '192', '294', '318', 304, 191, 197, 89, 92, 93)
   AND CLH.DATA_FIM = '31/12/2999'
   AND ORG.DATA_FIM = '31/12/2999'
   AND ORG3.DATA_FIM = '31/12/2999'
   AND CT.DATA_FIM IS NULL
   AND CLH.COD_CONTRATO NOT IN (
       SELECT AF.COD_CONTRATO
         FROM RHFP0306 AF
        WHERE AF.DATA_FIM = '31/12/2999'
   )
 ORDER BY ORG3.EDICAO_ORG ASC



--========================--


--TABELA A PARTIR DO SELECT ACIMA


CREATE TABLE GERENTES_LOJAS AS
SELECT DISTINCT CLH.COD_CONTRATO,
                PE.NOME_PESSOA,
                CLH.COD_CLH,
                CLH2.NOME_CLH,
                ORG3.EDICAO_ORG,
                ORG2.NOME_ORGANOGRAMA
FROM RHFP0340 CLH,
     RHFP0300 CT,
     RHFP0306 AF,
     RHFP0500 CLH2,
     PESSOA   PE,
     RHFP0310 ORG,
     RHFP0400 ORG2,
     RHFP0401 ORG3
WHERE CLH.COD_CONTRATO = CT.COD_CONTRATO
  AND CLH2.COD_CLH = CLH.COD_CLH
  AND PE.COD_PESSOA = CT.COD_FUNC
  AND ORG.COD_CONTRATO = CLH.COD_CONTRATO
  AND ORG2.COD_ORGANOGRAMA = ORG.COD_ORGANOGRAMA
  AND ORG3.COD_ORGANOGRAMA = ORG2.COD_ORGANOGRAMA
  AND AF.COD_CONTRATO = CT.COD_CONTRATO
  AND CLH.COD_CLH IN
      ('77', '78', '79', '80', '81', '86', '87', '88', '90', '184', '185',
       '186', '188', '189', '190', '192', '294', '318', 304, 191, 197, 89, 92, 93)
  AND CLH.DATA_FIM = '31/12/2999'
  AND ORG.DATA_FIM = '31/12/2999'
  AND ORG3.DATA_FIM = '31/12/2999'
  AND CT.DATA_FIM IS NULL
  AND CLH.COD_CONTRATO NOT IN (
      SELECT AF.COD_CONTRATO
        FROM RHFP0306 AF
       WHERE AF.DATA_FIM = '31/12/2999'
  )
ORDER BY ORG3.EDICAO_ORG ASC




--===========================--

--VIEW A PARTIR DO SELECT ACIMA

CREATE VIEW MY_VIEW AS
SELECT DISTINCT CLH.COD_CONTRATO,
                PE.NOME_PESSOA,
                CLH.COD_CLH,
                CLH2.NOME_CLH,
                ORG3.EDICAO_ORG,
                ORG2.NOME_ORGANOGRAMA
FROM RHFP0340 CLH,
     RHFP0300 CT,
     RHFP0306 AF,
     RHFP0500 CLH2,
     PESSOA   PE,
     RHFP0310 ORG,
     RHFP0400 ORG2,
     RHFP0401 ORG3
WHERE CLH.COD_CONTRATO = CT.COD_CONTRATO
  AND CLH2.COD_CLH = CLH.COD_CLH
  AND PE.COD_PESSOA = CT.COD_FUNC
  AND ORG.COD_CONTRATO = CLH.COD_CONTRATO
  AND ORG2.COD_ORGANOGRAMA = ORG.COD_ORGANOGRAMA
  AND ORG3.COD_ORGANOGRAMA = ORG2.COD_ORGANOGRAMA
  AND AF.COD_CONTRATO = CT.COD_CONTRATO
  AND CLH.COD_CLH IN
      ('77', '78', '79', '80', '81', '86', '87', '88', '90', '184', '185',
       '186', '188', '189', '190', '192', '294', '318', 304, 191, 197, 89, 92, 93)
  AND CLH.DATA_FIM = '31/12/2999'
  AND ORG.DATA_FIM = '31/12/2999'
  AND ORG3.DATA_FIM = '31/12/2999'
  AND CT.DATA_FIM IS NULL
  AND CLH.COD_CONTRATO NOT IN (
      SELECT AF.COD_CONTRATO
        FROM RHFP0306 AF
       WHERE AF.DATA_FIM = '31/12/2999'
  )
ORDER BY ORG3.EDICAO_ORG ASC;
