CREATE OR REPLACE VIEW V_DADOS_CONTRATO_AVT AS
SELECT CASE
         WHEN A.DATA_INICIO > SYSDATE THEN
          2 -- Admissão futura
         WHEN A.DATA_FIM IS NOT NULL AND A.DATA_FIM < TRUNC(SYSDATE) THEN
          1 -- Inativo, pois o dia da demissão já passou
         ELSE
          0 -- Ainda ativo
       END AS STATUS,

       CASE
         WHEN A.DATA_INICIO > SYSDATE THEN
          'ADMISSAO FUTURA'
         WHEN A.DATA_FIM IS NOT NULL AND A.DATA_FIM < TRUNC(SYSDATE) THEN
          'INATIVO'
         ELSE
          'ATIVO'
       END AS DES_STATUS,
       A.COD_CONTRATO,
       B.NOME_PESSOA AS DES_PESSOA,
       A.DATA_INICIO AS DATA_ADMISSAO,
       A.DATA_FIM AS DATA_DEMISSAO,
       A.COD_CAUSA_DEMISSAO AS COD_DEMISSAO,
       H.NOME_CAUSA_DEMISSAO AS DES_DEMISSA,
       A.DATA_AVANCO,
       A.COD_VINCULO_EMPREG,
       B.CPF,
       C.NRO_IDENTIDADE,
       B.DT_NASC AS DATA_NASCIMENTO,
       TRUNC(MONTHS_BETWEEN(SYSDATE, C.DATA_NASCIMENTO) / 12) AS IDADE,
       B.SEXO,
       B.DDD_FONE_CEL AS DDD,
       B.FONE_CEL AS CELULAR,
       B.EMAIL,
       B.EMAIL_ALTER,
       C.COD_ESTADO_CIVIL,
       D.NOME_ESTADO_CIVIL AS DES_ESTADO_CIVIL,
       C.COD_NACIONALIDADE,
       E.NOME_NACIONALIDADE AS DES_NACIONALIDADE,
       C.COD_RACA_COR,
       F.NOME_RACA_COR AS DES_RACA_COR,
       C.IND_DEFICIENCIA,
       C.COD_DEFICIENCIA,
       G.NOME_DEFICIENCIA AS DES_DEFICIENCIA,
       B.NOME_TIP_LOGRA AS DES_TIPO_LOGRA,
       B.NOME_LOGRA AS DES_LOGRA,
       B.NUMERO,
       B.NOME_BAIRRO AS DES_BAIRRO,
       B.NOME_MUNIC AS DES_CIDADE,
       B.CEP,
       B.COD_UF
  FROM RHFP0300 A
  INNER JOIN PESSOA_FISICA B ON A.COD_FUNC = B.COD_PESSOA
  INNER JOIN RHFP0200 C ON A.COD_FUNC = C.COD_FUNC
  LEFT JOIN RHFP0104 D ON C.COD_ESTADO_CIVIL = D.COD_ESTADO_CIVIL
  LEFT JOIN RHFP0107 E ON C.COD_NACIONALIDADE = E.COD_NACIONALIDADE
  LEFT JOIN RHFP0130 F ON C.COD_RACA_COR = F.COD_RACA_COR
  LEFT JOIN RHFP0132 G ON C.COD_DEFICIENCIA = G.COD_DEFICIENCIA
  LEFT JOIN RHFP0102 H ON A.COD_CAUSA_DEMISSAO = H.COD_CAUSA_DEMISSAO
 --WHERE A.COD_CONTRATO = 389622

