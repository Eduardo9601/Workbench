CREATE OR REPLACE VIEW V_UMENTOR_COLABORADORES AS
SELECT RHFP0300.COD_CONTRATO COD_FUNCIONARIO,
    NVL2(ORG_CUSTO_CTB.CUSTO_CONTABIL, ORG_EMP.EDICAO_NIVEL5, 001) COD_UNIDADE,
    NVL2(ORG_CUSTO_CTB.CUSTO_CONTABIL, ORG_EMP.EDICAO_NIVEL5, 001) COD_CENTRO_CUSTO,
    INITCAP(P.NOME_PESSOA) DES_NOME,
    RHFP0300.DATA_INICIO DTA_ADMISSAO,
    RHFP0300.DATA_FIM DTA_DEMISSAO,
    RHFP0200.DATA_NASCIMENTO DATA_NASCIMENTO,
    CASE
        WHEN ORGANOGRAMA.COD_ORGANOGRAMA = 8 THEN 'GRAZZIOTIN'
        WHEN ORGANOGRAMA.COD_ORGANOGRAMA = 4 THEN 'GZT'
        WHEN ORGANOGRAMA.COD_ORGANOGRAMA = 276 THEN 'CENTRO SHOPPING'
        WHEN ORGANOGRAMA.COD_ORGANOGRAMA = 280 THEN 'CAULESPAR'
        WHEN ORGANOGRAMA.COD_ORGANOGRAMA = 282 THEN 'FINANCIADORA'
        WHEN ORGANOGRAMA.COD_ORGANOGRAMA = 2 THEN 'VR'
        WHEN ORGANOGRAMA.COD_ORGANOGRAMA = 6 THEN 'GRATO'
        ELSE 'GRAZZIOTIN'
    END DES_EMPRESA,
    FUNCOES.COD_CLH COD_FUNCAO,
    TURNO.COD_TURNO,
    TRIM(TO_CHAR(HORAS2.QTD_HORBAS_MES, '999')) QTD_CH_MENSAL,
    TRIM(RHFP0200.NRO_CTPS) NUM_CART_TRAB,
    TRIM(RHFP0200.NRO_SERIE_CTPS) NUM_SERIE_CART_TRAB,
    NVL(AFASTAMENTO.COD_CAUSA_AFAST, 0) COD_AFASTAMENTO,
    AFASTAMENTO.DATA_INICIO DATA_AFASTAMENTO_INI,
    AFASTAMENTO.DATA_FIM DATA_AFASTAMENTO_FIM,
    TRIM(FIS.CPF) CPF
FROM RHFP0300 RHFP0300
INNER JOIN RHFP0200 RHFP0200 ON RHFP0200.COD_FUNC = RHFP0300.COD_FUNC
INNER JOIN PESSOA P ON P.COD_PESSOA = RHFP0200.COD_FUNC
INNER JOIN FISICA FIS ON FIS.COD_PESSOA = RHFP0200.COD_FUNC
INNER JOIN RHFP0310 CONTR_ORGANOGRAMA ON RHFP0300.COD_CONTRATO = CONTR_ORGANOGRAMA.COD_CONTRATO
INNER JOIN RHFP0400 ORGANOGRAMA ON CONTR_ORGANOGRAMA.COD_ORGANOGRAMA = ORGANOGRAMA.COD_ORGANOGRAMA
INNER JOIN RHFP0401 ORG_EMP ON ORGANOGRAMA.COD_ORGANOGRAMA = ORG_EMP.COD_ORGANOGRAMA
INNER JOIN RHFP0340 CONTRFUNC ON RHFP0300.COD_CONTRATO = CONTRFUNC.COD_CONTRATO
INNER JOIN RHFP0500 FUNCOES ON FUNCOES.COD_CLH = CONTRFUNC.COD_CLH
INNER JOIN RHAF1119 TURNO ON RHFP0300.COD_CONTRATO = TURNO.COD_CONTRATO
INNER JOIN RHFP0307 HORAS ON RHFP0300.COD_CONTRATO = HORAS.COD_CONTRATO
INNER JOIN RHFP0321 HORAS2 ON HORAS.COD_HORAS_BASE = HORAS2.COD_HORAS_BASE
LEFT JOIN RHFP0402 ORG_CUSTO_CTB ON ORGANOGRAMA.COD_CUSTO_CONTABIL = ORG_CUSTO_CTB.COD_CUSTO_CONTABIL
LEFT JOIN RHFP0306 AFASTAMENTO ON RHFP0300.COD_CONTRATO = AFASTAMENTO.COD_CONTRATO  AND TRUNC(SYSDATE) BETWEEN AFASTAMENTO.DATA_INICIO AND AFASTAMENTO.DATA_FIM
LEFT JOIN MDL_USUARIO SENHA ON RHFP0300.COD_CONTRATO = SENHA.COD_CONTRATO
LEFT JOIN RHFP0308 DES_TURNO ON RHFP0300.COD_CONTRATO = DES_TURNO.COD_CONTRATO
WHERE TRUNC(SYSDATE) BETWEEN TURNO.DATA_INICIO AND  TURNO.DATA_FIM
  AND TRUNC(SYSDATE) BETWEEN  HORAS.DATA_INICIO AND HORAS.DATA_FIM
  AND TRUNC(SYSDATE) BETWEEN RHFP0300.DATA_INICIO AND RHFP0300.DATA_FIM
  AND CONTR_ORGANOGRAMA.DATA_FIM > TRUNC(SYSDATE)
  AND CONTRFUNC.DATA_FIM > TRUNC(SYSDATE)
  AND ORG_EMP.DATA_INICIO <= TRUNC(SYSDATE)
  AND ORG_EMP.DATA_FIM > TRUNC(SYSDATE)
  AND RHFP0200.NRO_SERIE_CTPS IS NOT NULL
  AND RHFP0200.NRO_CTPS IS NOT NULL
  AND FIS.CPF IS NOT NULL
  AND ( RHFP0300.DATA_FIM IS NULL
   OR RHFP0300.DATA_FIM >= TRUNC(SYSDATE)
  )

