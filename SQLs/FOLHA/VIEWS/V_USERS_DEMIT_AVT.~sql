CREATE OR REPLACE VIEW V_USERS_DEMIT_AVT AS
SELECT DISTINCT A.COD_CONTRATO,
       B.NOME_PESSOA,
       E.COD_CLH || ' - ' || F.NOME_CLH AS FUNCAO,
       A.DATA_FIM AS DATA_DEMISSAO,
       D.EDICAO_ORG AS UNIDADE,
       D.COD_NIVEL2 AS EMPRESA
FROM RHFP0300 A
INNER JOIN PESSOA_FISICA B ON A.COD_FUNC = B.COD_PESSOA
INNER JOIN RHFP0310 C ON A.COD_CONTRATO = C.COD_CONTRATO AND C.DATA_FIM = '31/12/2999'
INNER JOIN RHFP0401 D ON C.COD_ORGANOGRAMA = D.COD_ORGANOGRAMA
INNER JOIN RHFP0340 E ON E.COD_CONTRATO = A.COD_CONTRATO
INNER JOIN RHFP0500 F ON F.COD_CLH = E.COD_CLH
WHERE A.DATA_FIM >= TRUNC(SYSDATE) - 20

