CREATE OR REPLACE VIEW V_INTRAJORN_INFE_11HRS_AVT AS
SELECT DISTINCT RHAF1123.COD_CONTRATO,
                VDP.DES_PESSOA,
                ORG.COD_UNIDADE,
                ORG.DES_UNIDADE,
                VDP.COD_GRUPO,
                VDP.DES_GRUPO,
                RHAF1129.COD_OCORRENCIA,
                RHAF1129.NOME_OCORRENCIA,
                TO_CHAR(RHAF1123.DATA_OCORRENCIA, 'MONTH') AS NOME_MES,
                TRIM(TO_CHAR(RHAF1123.DATA_OCORRENCIA, 'Month')) || '/' ||
                TO_CHAR(RHAF1123.DATA_OCORRENCIA, 'YYYY') AS MES_OCORRENCIA,
                TO_CHAR(RHAF1123.DATA_OCORRENCIA, 'DD/MM/YYYY') AS DATA_COMPLETA,
                RHAF1123.ORIGEM,
                TO_CHAR(TRUNC(RHAF1123.NUM_HORAS)) || ':' ||
                TO_CHAR(MOD(RHAF1123.NUM_HORAS * 60, 60), 'FM00') AS NUM_HORAS_HM,
                TRIM(TO_CHAR(SYSDATE, 'MONTH')) || '/' ||
                TO_CHAR(SYSDATE, 'YYYY') AS REFERENCIA,
                TO_CHAR(SYSDATE, 'DD') || ' de ' ||
                TRIM(TO_CHAR(SYSDATE, 'Month')) || ' de ' ||
                TO_CHAR(SYSDATE, 'YYYY') AS REF_COMPLETA,
                GER.NOME_PESSOA AS GERENTE
  FROM RHAF1123                 RHAF1123,
       RHAF1129                 RHAF1129,
       RHAF1138                 RHAF1138,
       RHAF1108                 RHAF1108,
       RHAF1119                 RHAF1119,
       RHAF1145                 RHAF1145,
       RHFP0310                 RHFP0310,
       V_DADOS_ORGANOGRAMAS_AVT ORG,
       V_DADOS_PESSOA           VDP,
       V_GERENTES_LOJAS_AVT     GER
 WHERE RHAF1123.COD_OCORRENCIA = RHAF1129.COD_OCORRENCIA
   AND RHAF1123.COD_CONTRATO = RHAF1108.COD_CONTRATO(+)
   AND RHAF1123.COD_CONTRATO = RHAF1119.COD_CONTRATO
   AND RHAF1119.COD_TURNO = RHAF1145.COD_TURNO
   AND RHAF1123.COD_CONTRATO = RHFP0310.COD_CONTRATO
   AND RHFP0310.COD_ORGANOGRAMA = ORG.COD_ORGANOGRAMA
   AND VDP.COD_CONTRATO = RHAF1123.COD_CONTRATO
   AND VDP.COD_CONTRATO = RHAF1123.COD_CONTRATO
   AND GER.COD_UNIDADE = VDP.COD_UNIDADE
   --AND RHAF1123.DATA_OCORRENCIA BETWEEN :DATA_INICIO_OCO AND :DATA_FIM_OCO
   AND RHAF1123.DATA_OCORRENCIA BETWEEN RHAF1108.DATA_INICIO AND
       RHAF1108.DATA_FIM
   AND RHAF1129.COD_MOTIVO_OCO = RHAF1138.COD_MOTIVO_OCO(+)
   AND RHAF1123.DATA_OCORRENCIA BETWEEN ADD_MONTHS(SYSDATE, -6) AND SYSDATE
   AND GER.IND_RESP_UNI = 'S'
   AND GER.COD_CONTRATO NOT IN 387620
   AND RHFP0310.DATA_FIM = '31/12/2999'
   AND ORG.COD_EMP = 8
   --AND (ORG.COD_UNIDADE = :FILIAL OR :FILIAL = 0)
   --AND (VDP.COD_GRUPO = TO_CHAR(:REDE) OR TO_CHAR(:REDE) = 0)
   AND ORG.COD_REDE_LOCAL NOT IN ('013', '001')
   AND RHAF1123.COD_OCORRENCIA = 901
 ORDER BY ORG.COD_UNIDADE, RHAF1123.COD_CONTRATO ASC

