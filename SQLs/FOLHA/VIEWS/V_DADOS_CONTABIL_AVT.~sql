CREATE OR REPLACE VIEW V_DADOS_CONTABIL_AVT AS
SELECT A.COD_VD,
       A.NOME_VD,
       D.COD_CONTA_CONTABIL,
       E.NOME_CONTA_CONTABIL,
       D.COD_LANCAMENTO,
       D.TIPO_LANCAMENTO,
       CASE
         WHEN D.TIPO_LANCAMENTO = 'D' THEN
          'DÉBITO'
         WHEN D.TIPO_LANCAMENTO = 'C' THEN
          'CRÉDITO'
         ELSE
          NULL
       END AS DES_TIPO_LANCAMENTO,
       D.COD_CONTRAPARTIDA,
       D.COD_HISTORICO,
       MAX(G.HISTORICO_COMP) AS DES_HISTORICO,
       D.COD_HISTORICO_CONTRA,
       MAX(G1.HISTORICO_COMP) AS DES_HISTORICO_CONTRA,
       C.COD_TOTAL,
       H.NOME_TOTAL,
       D.COD_CLASSE_CONT,
       F.NOME_CLASSE_CONT,
       D.COD_NIVEL_CONTABIL
      /*CASE
           WHEN D.COD_SELECAO = 'FADM' THEN 'CONTA ADM/CD'
           WHEN D.COD_SELECAO = 'FADMDIF' THEN 'CONTA LOJAS'
           ELSE NULL
       END AS DESCRICAO_CONTAS*/
  FROM RHFP1000 A
 INNER JOIN RHFP0446 B ON B.COD_VD = A.COD_VD
 INNER JOIN RHFP0405 C ON C.COD_TOTAL = B.COD_TOTAL
 INNER JOIN RHFP0404 D ON C.COD_LANCAMENTO = D.COD_LANCAMENTO
 INNER JOIN RHFP0403 E ON D.COD_CONTA_CONTABIL = E.COD_CONTA_CONTABIL
 INNER JOIN RHFP0414 F ON F.COD_CLASSE_CONT = D.COD_CLASSE_CONT
 INNER JOIN RHFP0415 G ON G.COD_HISTORICO = D.COD_HISTORICO
 INNER JOIN RHFP0415 G1 ON G1.COD_HISTORICO = D.COD_HISTORICO_CONTRA
 INNER JOIN RHFP0445 H ON H.COD_TOTAL = C.COD_TOTAL
 WHERE D.COD_CLASSE_CONT NOT IN (1, 12, 25)
 GROUP BY A.COD_VD,
          A.NOME_VD,
          D.COD_CONTA_CONTABIL,
          E.NOME_CONTA_CONTABIL,
          D.COD_LANCAMENTO,
          D.TIPO_LANCAMENTO,
          D.COD_CONTRAPARTIDA,
          D.COD_HISTORICO,
          D.COD_HISTORICO_CONTRA,
          C.COD_TOTAL,
          H.NOME_TOTAL,
          D.COD_CLASSE_CONT,
          F.NOME_CLASSE_CONT,
          D.COD_NIVEL_CONTABIL,
          D.COD_SELECAO
 ORDER BY D.COD_CLASSE_CONT ASC, C.COD_TOTAL ASC, A.COD_VD ASC

