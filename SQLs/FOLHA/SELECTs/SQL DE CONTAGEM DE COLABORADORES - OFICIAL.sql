--SQL DE CONTAGEM DE COLABORADORES = OFICIAL


SELECT
    CASE
        WHEN GROUPING(COD_UNIDADE) = 1 AND GROUPING(COD_REDE_LOCAL) = 0 THEN NULL
        WHEN GROUPING(COD_UNIDADE) = 1 AND GROUPING(COD_REDE_LOCAL) = 1 THEN 'TOTAL GERAL'
        ELSE COD_UNIDADE
    END AS COD_UNIDADE,
    CASE
        WHEN GROUPING(DES_UNIDADE) = 1 AND GROUPING(COD_REDE_LOCAL) = 0 THEN ''
        WHEN GROUPING(DES_UNIDADE) = 1 AND GROUPING(COD_REDE_LOCAL) = 1 THEN NULL
        ELSE DES_UNIDADE
    END AS DES_UNIDADE,
    CASE
        WHEN GROUPING(COD_REDE_LOCAL) = 1 THEN NULL
        ELSE COD_REDE_LOCAL
    END AS COD_REDE_LOCAL,
    CASE
        WHEN GROUPING(DES_UNIDADE) = 1 AND GROUPING(COD_REDE_LOCAL) = 0 THEN 'TOTAL DA REDE'
        WHEN GROUPING(DES_UNIDADE) = 1 AND GROUPING(COD_REDE_LOCAL) = 1 THEN NULL
        ELSE DES_REDE_LOCAL
    END AS DES_REDE_LOCAL,
    COUNT(COD_CONTRATO) AS QTD_CONTRATOS,
    SUM(CASE
             WHEN COD_FUNCAO NOT IN
                  (7, 8, 14, 68, 71, 74, 77, 78, 79, 80, 81, 86, 87, 88, 90, 128, 137, 168, 184, 185, 186, 188, 189, 190, 192, 255, 268, 275, 283, 294, 299, 301, 302, 304, 310, 318, 325) THEN
              1
             ELSE
              0
           END) QTD_COLABORADORES,
       SUM(CASE
             WHEN COD_FUNCAO IN
                  (7, 8, 14, 77, 78, 79, 80, 81, 86, 87, 88, 90, 128, 137, 184, 185, 186, 188, 189, 190, 192, 255, 268, 275, 283, 294, 299, 301, 302, 304, 318, 325) THEN
              1
             ELSE
              0
           END) QTD_GERENTES,
       SUM(CASE
             WHEN CARGA_HORARIA = 120 THEN
              1
             ELSE
              0
           END) QTD_CARGA_120
FROM V_DADOS_COLAB_AVT
WHERE
    COD_EMP = '008' AND
    STATUS = 0 AND
    COD_SETOR_LOJA NOT IN ('001', '013') AND
    (DATA_FIM_AFAST IS NULL OR DATA_FIM_AFAST <> TO_DATE('31/12/2999', 'DD/MM/YYYY')) AND
    (COD_REDE_LOCAL = TO_CHAR(:REDE) OR TO_CHAR(:REDE) = 0) AND
    DATA_ADMISSAO <= :DATA_REFERENCIA AND
    (DATA_DEMISSAO IS NULL OR DATA_DEMISSAO >= :DATA_REFERENCIA)
GROUP BY GROUPING SETS (
    (COD_REDE_LOCAL, DES_REDE_LOCAL, COD_UNIDADE, DES_UNIDADE),
    (COD_REDE_LOCAL, DES_REDE_LOCAL),
    ()
)
ORDER BY CASE
            WHEN COD_REDE_LOCAL = 10 THEN
             1
            WHEN COD_REDE_LOCAL = 30 THEN
             2
            WHEN COD_REDE_LOCAL = 40 THEN
             3
            WHEN COD_REDE_LOCAL = 50 THEN
             4
            WHEN COD_REDE_LOCAL = 70 THEN
             5
            ELSE
             6 -- Isso é apenas uma precaução, caso existam outros valores não especificados.
          END,
    COD_UNIDADE ASC









------

OUTRA VERSÃO 



SELECT
    CASE
        WHEN GROUPING(COD_UNIDADE) = 1 AND GROUPING(COD_REDE_LOCAL) = 0 THEN NULL
        WHEN GROUPING(COD_UNIDADE) = 1 AND GROUPING(COD_REDE_LOCAL) = 1 THEN 'TOTAL GERAL'
        ELSE COD_UNIDADE
    END AS COD_UNIDADE,
    CASE
        WHEN GROUPING(DES_UNIDADE) = 1 AND GROUPING(COD_REDE_LOCAL) = 0 THEN ''
        WHEN GROUPING(DES_UNIDADE) = 1 AND GROUPING(COD_REDE_LOCAL) = 1 THEN NULL
        ELSE DES_UNIDADE
    END AS DES_UNIDADE,
    CASE
        WHEN GROUPING(COD_REDE_LOCAL) = 1 THEN NULL
        ELSE COD_REDE_LOCAL
    END AS COD_REDE_LOCAL,
    CASE
        WHEN GROUPING(DES_UNIDADE) = 1 AND GROUPING(COD_REDE_LOCAL) = 0 THEN 'TOTAL DA REDE'
        WHEN GROUPING(DES_UNIDADE) = 1 AND GROUPING(COD_REDE_LOCAL) = 1 THEN NULL
        ELSE DES_REDE_LOCAL
    END AS DES_REDE_LOCAL,
    COUNT(COD_CONTRATO) AS QTD_CONTRATOS,
    SUM(
        CASE
            WHEN COD_FUNCAO NOT IN (7, 8, 14, 68, 71, 74, 77, 78, 79, 80, 81, 86, 87, 88, 90, 128, 137, 168, 184, 185, 186, 188, 189, 190, 192, 255, 268, 275, 283, 294, 299, 301, 302, 304, 310, 318, 325) THEN
                1
            ELSE
                0
        END
    ) AS QTD_COLABORADORES,
    SUM(
        CASE
            WHEN COD_FUNCAO IN (7, 8, 14, 77, 78, 79, 80, 81, 86, 87, 88, 90, 128, 137, 184, 185, 186, 188, 189, 190, 192, 255, 268, 275, 283, 294, 299, 301, 302, 304, 318, 325) THEN
                1
            ELSE
                0
        END
    ) AS QTD_GERENTES,
    SUM(
        CASE
            WHEN CARGA_HORARIA = 120 THEN
                1
            ELSE
                0
        END
    ) AS QTD_CARGA_120,
    CASE
        WHEN GROUPING(DES_UNIDADE) = 1 AND GROUPING(COD_REDE_LOCAL) = 0 THEN COUNT(COD_CONTRATO)
        ELSE NULL
    END AS TOTAL_CONTRATOS_REDE,
    CASE
        WHEN GROUPING(DES_UNIDADE) = 1 AND GROUPING(COD_REDE_LOCAL) = 0 THEN SUM(
            CASE
                WHEN COD_FUNCAO NOT IN (7, 8, 14, 68, 71, 74, 77, 78, 79, 80, 81, 86, 87, 88, 90, 128, 137, 168, 184, 185, 186, 188, 189, 190, 192, 255, 268, 275, 283, 294, 299, 301, 302, 304, 310, 318, 325) THEN
                    1
                ELSE
                    0
            END
        )
        ELSE NULL
    END AS TOTAL_COLABORADORES_REDE,
    CASE
        WHEN GROUPING(DES_UNIDADE) = 1 AND GROUPING(COD_REDE_LOCAL) = 0 THEN SUM(
            CASE
                WHEN COD_FUNCAO IN (7, 8, 14, 77, 78, 79, 80, 81, 86, 87, 88, 90, 128, 137, 184, 185, 186, 188, 189, 190, 192, 255, 268, 275, 283, 294, 299, 301, 302, 304, 318, 325) THEN
                    1
                ELSE
                    0
            END
        )
        ELSE NULL
    END AS TOTAL_GERENTES_REDE,
    CASE
        WHEN GROUPING(DES_UNIDADE) = 1 AND GROUPING(COD_REDE_LOCAL) = 0 THEN SUM(
            CASE
                WHEN CARGA_HORARIA = 120 THEN
                    1
                ELSE
                    0
            END
        )
        ELSE NULL
    END AS TOTAL_CARGA_120_REDE,
    CASE
        WHEN GROUPING(DES_UNIDADE) = 1 AND GROUPING(COD_REDE_LOCAL) = 1 THEN COUNT(COD_CONTRATO)
        ELSE NULL
    END AS TOTAL_GERAL_CONTRATOS
FROM V_DADOS_COLAB_AVT
WHERE
    COD_EMP = '008' AND
    STATUS = 0 AND
    COD_SETOR_LOJA NOT IN ('001', '013') AND
    (DATA_FIM_AFAST IS NULL OR DATA_FIM_AFAST <> TO_DATE('31/12/2999', 'DD/MM/YYYY')) AND
    (COD_REDE_LOCAL = TO_CHAR(:REDE) OR TO_CHAR(:REDE) = 0) AND
    DATA_ADMISSAO <= :DATA_REFERENCIA AND
    (DATA_DEMISSAO IS NULL OR DATA_DEMISSAO >= :DATA_REFERENCIA)
GROUP BY GROUPING SETS (
    (COD_REDE_LOCAL, DES_REDE_LOCAL, COD_UNIDADE, DES_UNIDADE),
    (COD_REDE_LOCAL, DES_REDE_LOCAL),
    ()
)
ORDER BY
    CASE
        WHEN COD_REDE_LOCAL = 10 THEN 1
        WHEN COD_REDE_LOCAL = 30 THEN 2
        WHEN COD_REDE_LOCAL = 40 THEN 3
        WHEN COD_REDE_LOCAL = 50 THEN 4
        WHEN COD_REDE_LOCAL = 70 THEN 5
        ELSE 6
    END,
    COD_UNIDADE ASC


