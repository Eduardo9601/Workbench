CREATE OR REPLACE VIEW V_DADOS_CONTABIL_AVT AS
SELECT RHFP1000.COD_VD,
       RHFP1000.NOME_VD,
       RHFP0404.COD_CONTA_CONTABIL,
       RHFP0403.NOME_CONTA_CONTABIL,
       RHFP0404.COD_LANCAMENTO,
       RHFP0404.TIPO_LANCAMENTO,
       CASE
           WHEN RHFP0404.TIPO_LANCAMENTO = 'D' THEN
            'DÉBITO'
           WHEN RHFP0404.TIPO_LANCAMENTO = 'C' THEN
            'CRÉDITO'
           ELSE NULL
       END AS DES_TIPO_LANCAMENTO,
       RHFP0404.COD_CONTRAPARTIDA,
       RHFP0404.COD_HISTORICO,
       MAX(RHFP0415.HISTORICO_COMP) AS DES_HISTORICO,
       RHFP0404.COD_HISTORICO_CONTRA,
       RHFP0405.COD_TOTAL,
       RHFP0445.NOME_TOTAL,
       RHFP0404.COD_CLASSE_CONT,
       RHFP0414.NOME_CLASSE_CONT,
       RHFP0404.COD_NIVEL_CONTABIL
       /*CASE
           WHEN RHFP0404.COD_SELECAO = 'FADM' THEN 'CONTA ADM/CD'
           WHEN RHFP0404.COD_SELECAO = 'FADMDIF' THEN 'CONTA LOJAS'
           ELSE NULL
       END AS DESCRICAO_CONTAS*/
FROM RHFP1000
INNER JOIN RHFP0446 ON RHFP0446.COD_VD = RHFP1000.COD_VD
INNER JOIN RHFP0405 ON RHFP0405.COD_TOTAL = RHFP0446.COD_TOTAL
INNER JOIN RHFP0404 ON RHFP0405.COD_LANCAMENTO = RHFP0404.COD_LANCAMENTO
INNER JOIN RHFP0403 ON RHFP0404.COD_CONTA_CONTABIL = RHFP0403.COD_CONTA_CONTABIL
INNER JOIN RHFP0414 ON RHFP0414.COD_CLASSE_CONT = RHFP0404.COD_CLASSE_CONT
INNER JOIN RHFP0415 ON RHFP0415.COD_HISTORICO = RHFP0404.COD_HISTORICO
INNER JOIN RHFP0445 ON RHFP0445.COD_TOTAL = RHFP0405.COD_TOTAL
WHERE RHFP0404.COD_CLASSE_CONT NOT IN (1, 12, 25)
GROUP BY RHFP1000.COD_VD,
         RHFP1000.NOME_VD,
         RHFP0404.COD_CONTA_CONTABIL,
         RHFP0403.NOME_CONTA_CONTABIL,
         RHFP0404.COD_LANCAMENTO,
         RHFP0404.TIPO_LANCAMENTO,
         RHFP0404.COD_CONTRAPARTIDA,
         RHFP0404.COD_HISTORICO,
         RHFP0404.COD_HISTORICO_CONTRA,
         RHFP0405.COD_TOTAL,
         RHFP0445.NOME_TOTAL,
         RHFP0404.COD_CLASSE_CONT,
         RHFP0414.NOME_CLASSE_CONT,
         RHFP0404.COD_NIVEL_CONTABIL,
         RHFP0404.COD_SELECAO
ORDER BY RHFP0404.COD_CLASSE_CONT ASC, RHFP0405.COD_TOTAL ASC, RHFP1000.COD_VD ASC

