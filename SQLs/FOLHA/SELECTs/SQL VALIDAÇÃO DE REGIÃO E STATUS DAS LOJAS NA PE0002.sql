/*SQL VALIDAÇÃO DE REGIÃO E STATUS DAS LOJAS NA PE0002*/

SELECT A.EDICAO_ORG, B.NOME_ORGANOGRAMA, C.VALOR, A1.COD_GRUPO
FROM RHFP0401 A
INNER JOIN RHFP0400 B ON A.COD_ORGANOGRAMA = B.COD_ORGANOGRAMA
 LEFT JOIN PE0002 C ON B.COD_PESSOA = C.COD_PESSOA
 LEFT JOIN NL.GE_GRUPOS_UNIDADES@NLGRZ A1 ON A.EDICAO_ORG = A1.COD_UNIDADE
WHERE C.COD_CAMPO = 1
AND C.VALOR <> 9999
AND A1.COD_GRUPO IN
       (8701, 8702, 8703, 8704, 8705, 8706, 8707, 8708, 8709, 8710, 8711, 8712, 8713, 8714, 8715, 8716, 8717, 8718, 8719, 8720, 8721, 8722, 8723)  

ORDER BY A.EDICAO_ORG



UPDATE PE0002 P
   SET P.VALOR = 0
 WHERE P.COD_CAMPO = 0
   AND EXISTS
 (SELECT 1
          FROM RHFP0401 A
          JOIN RHFP0400 B ON A.COD_ORGANOGRAMA = B.COD_ORGANOGRAMA
          JOIN NL.GE_GRUPOS_UNIDADES@NLGRZ G ON A.EDICAO_ORG = G.COD_UNIDADE
          JOIN PE0002 C ON B.COD_PESSOA = C.COD_PESSOA
                       AND C.COD_CAMPO = 1
         WHERE B.COD_PESSOA = P.COD_PESSOA
           AND C.VALOR <> 9999
           AND G.COD_GRUPO IN
               (8701, 8702, 8703, 8704, 8705, 8706, 8707, 8708, 8709, 8710, 8711, 8712, 8713, 8714, 8715, 8716, 8717, 8718, 8719, 8720, 8721, 8722, 8723));

