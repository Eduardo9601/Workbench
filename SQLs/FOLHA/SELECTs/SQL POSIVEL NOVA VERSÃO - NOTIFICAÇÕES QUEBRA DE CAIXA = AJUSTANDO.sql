/*SQL NOTIFICAÇÕES QUEBRA DE CAIXA*/


SELECT PESSOA.EDICAO_NIVEL3
      ,PESSOA.NOME_ORGANOGRAMA
      ,PESSOA.COD_CONTRATO
      ,PESSOA.NOME_FUNCIONARIO
      ,(TRIM(TO_CHAR(RHYF0118(TEMPO.TEMPO_LOGIN_EM_HORAS),'990,00'))) AS TEMPO_LOGIN_TOT
      ,K.QTD_HORBAS_MES
      ,VALOR.COD_VD
      ,VALOR.VALOR_VD
      
FROM
(SELECT F.COD_USUARIO,  SUM(ROUND((F.TEMPO_LOGIN / 60), 2))  AS
TEMPO_LOGIN_EM_HORAS FROM SISLOGWEB.GER_TEMPO_LOGIN@NLGRZ F WHERE
SUBSTR(F.HORA_INICIAL,1, 10) BETWEEN :DATA_INICIAL AND :DATA_FINAL GROUP
BY F.COD_USUARIO) TEMPO,
(SELECT DISTINCT G.EDICAO_NIVEL3
              , E.NOME_ORGANOGRAMA
              , B.COD_CONTRATO
              , A.NOME_PESSOA AS NOME_FUNCIONARIO
FROM PESSOA A
   , RHFP0300 B
   , RHFP0310 D
   , RHFP0400 E
   , RHFP0401 G
 --, V_DADOS_PESSOA H
WHERE B.COD_FUNC = A.COD_PESSOA
AND D.COD_CONTRATO = B.COD_CONTRATO
--AND B.COD_CONTRATO = H.COD_CONTRATO
AND E.COD_ORGANOGRAMA = D.COD_ORGANOGRAMA
AND E.COD_ORGANOGRAMA = G.COD_ORGANOGRAMA
AND D.DATA_FIM = '31/12/2999'
AND b.DATA_FIM  is null
AND G.EDICAO_NIVEL3 NOT IN ('001', '013')
ORDER BY G.EDICAO_NIVEL3, B.COD_CONTRATO) PESSOA,
(SELECT COD_CONTRATO, COD_CLH
 FROM RHFP0340
 WHERE DATA_FIM = '31/12/2999'
 AND COD_CLH NOT IN
(96,168,205,71,74,75,199,202,209,213,216,221,6,7,8,14,77,78,79,80,81,86,
87,88,89,90,92,93,128,132,133,134,135,136,137,138,139
,148,184,185,186,188,189,190,191,195,196,197,247,252,255,264,268,275,278
,279,283,294,299,301,302,304,307,318
,325,328,330)) CARGO,
(SELECT DISTINCT A.COD_CONTRATO, B.COD_EVENTO, C.COD_VD, A.QTDE_VD, C.VALOR_VD, B.DATA_INI_MOV, B.DATA_FIM_MOV, C.DATA_REFERENCIA
 FROM RHFP1006 A
 INNER JOIN RHFP1003 B ON A.COD_MESTRE_EVENTO = B.COD_MESTRE_EVENTO
 INNER JOIN RHFP1005 C ON A.COD_CONTRATO = C.COD_CONTRATO
 WHERE B.COD_EVENTO = 1
 AND A.QTDE_VD <> 0
 AND C.VALOR_VD <> 0
 AND C.COD_VD = 38
 AND B.DATA_INI_MOV = :DATA_INI_MOV
 AND B.DATA_FIM_MOV = :DATA_FIM_MOV
 AND C.DATA_REFERENCIA = :DATA_REFERENCIA) VALOR,
RHFP0307 G,
RHFP0321 K
WHERE TEMPO.COD_USUARIO = PESSOA.COD_CONTRATO
   AND CARGO.COD_CONTRATO = PESSOA.COD_CONTRATO
   AND G.COD_CONTRATO = TEMPO.COD_USUARIO
   AND K.COD_HORAS_BASE = G.COD_HORAS_BASE
   AND VALOR.COD_CONTRATO = PESSOA.COD_CONTRATO
   AND G.DATA_FIM = '31/12/2999'
   --AND PESSOA.COD_CONTRATO = :COD_CONTRATO
ORDER BY PESSOA.EDICAO_NIVEL3, TEMPO.COD_USUARIO