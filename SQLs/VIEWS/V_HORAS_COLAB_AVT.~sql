CREATE OR REPLACE VIEW V_HORAS_COLAB_AVT AS
SELECT RHFP0307.COD_CONTRATO,
       RHFP0307.DATA_INICIO,
       RHFP0307.DATA_FIM,
       RHFP0307.COD_HORAS_BASE,
       RHFP0321.QTD_HORBAS_MES,
       RHFP0321.QTD_HORBAS_SEM,
       RHFP0321.QTD_HORBAS_DIA,
       RHFP0307.COD_MOTIVO,
       RHFP0323.NOME_MOTIVO,
       RHFP0323.COD_TIPO_MOTIVO,
       RHFP0115.NOME_TIPO_MOTIVO,
       ANTERIOR.DATA_INICIO AS DATA_INICIO_ANTERIOR,
       ANTERIOR.DATA_FIM AS DATA_FIM_ANTERIOR,
       ANTERIOR.COD_HORAS_BASE AS COD_HORAS_BASE_ANTERIOR,
       ANTERIOR.QTD_HORBAS_MES AS QTD_HORBAS_MES_ANTERIOR,
       ANTERIOR.QTD_HORBAS_SEM AS QTD_HORBAS_SEM_ANTERIOR,
       ANTERIOR.QTD_HORBAS_DIA AS QTD_HORBAS_DIA_ANTERIOR,
       ANTERIOR.COD_MOTIVO AS COD_MOTIVO_ANTERIOR,
       ANTERIOR.NOME_MOTIVO AS NOME_MOTIVO_ANTERIOR,
       ANTERIOR.COD_TIPO_MOTIVO AS COD_TIPO_MOTIVO_ANTERIOR,
       ANTERIOR.NOME_TIPO_MOTIVO AS NOME_TIPO_MOTIVO_ANTERIOR
  FROM RHFP0321 RHFP0321,
       RHFP0307 RHFP0307,
       RHFP0323 RHFP0323,
       RHFP0115 RHFP0115,
       (SELECT RHFP0307.COD_CONTRATO,
               RHFP0307.DATA_INICIO,
               RHFP0307.DATA_FIM,
               RHFP0307.COD_HORAS_BASE,
               RHFP0321.QTD_HORBAS_MES,
               RHFP0321.QTD_HORBAS_SEM,
               RHFP0321.QTD_HORBAS_DIA,
               RHFP0307.COD_MOTIVO,
               RHFP0323.NOME_MOTIVO,
               RHFP0323.COD_TIPO_MOTIVO,
               RHFP0115.NOME_TIPO_MOTIVO
          FROM RHFP0321 RHFP0321,
               RHFP0307 RHFP0307,
               RHFP0323 RHFP0323,
               RHFP0115 RHFP0115
         WHERE RHFP0307.COD_HORAS_BASE = RHFP0321.COD_HORAS_BASE(+)
           AND RHFP0307.COD_MOTIVO = RHFP0323.COD_MOTIVO(+)
           AND RHFP0323.COD_TIPO_MOTIVO = RHFP0115.COD_TIPO_MOTIVO(+)) ANTERIOR
 WHERE /*trunc(sysdate) BETWEEN RHFP0307.DATA_INICIO AND RHFP0307.DATA_FIM*/
   RHFP0307.COD_HORAS_BASE = RHFP0321.COD_HORAS_BASE(+)
   AND RHFP0307.COD_MOTIVO = RHFP0323.COD_MOTIVO(+)
   AND RHFP0323.COD_TIPO_MOTIVO = RHFP0115.COD_TIPO_MOTIVO(+)
   AND RHFP0307.COD_CONTRATO = ANTERIOR.COD_CONTRATO(+)
   AND RHFP0307.DATA_INICIO - 1 = ANTERIOR.DATA_FIM(+)