CREATE OR REPLACE VIEW V_STATUS_COLAB_AVT AS
SELECT A.COD_CONTRATO,
       CASE
         WHEN A.DATA_INICIO > TRUNC(SYSDATE) THEN
          NULL
         ELSE
          PF.NOME_PESSOA
       END AS DES_PESSOA,
       O.EDICAO_ORG AS COD_UNIDADE,
       O.COD_NIVEL2 AS COD_EMP,
       CASE
         WHEN O.COD_NIVEL2 = 4 THEN
          'MUNDIART S/A'
         WHEN O.COD_NIVEL2 = 8 THEN
          'GRAZZIOTIN S/A'
         WHEN O.COD_NIVEL2 = 6 THEN
          'GRATO AGROPECUÁRIA LTDA'
         WHEN O.COD_NIVEL2 = 1629 THEN
          'FLORESTA GRAZZIOTIN LTDA'
         WHEN O.COD_NIVEL2 = 276 THEN
          'CENTRO SHOPPING LTDA'
         WHEN O.COD_NIVEL2 = 282 THEN
          'FINANCEIRA S/A'
         ELSE
          NULL
       END AS DES_EMPRESA,
       A.DATA_INICIO AS DATA_ADMISSAO,
       A.DATA_FIM AS DATA_DEMISSAO,
       CASE
         WHEN A.DATA_FIM < TRUNC(SYSDATE) THEN
          1
         ELSE
          0
       END AS STATUS,
       CASE
         WHEN A.DATA_FIM < TRUNC(SYSDATE) THEN
          'INATIVO'
         WHEN A.DATA_INICIO <= TRUNC(SYSDATE) THEN
          'ATIVO'
         ELSE
          'ADMISSAO_FUTURA'
       END AS DESC_STATUS,
       B.DATA_INICIO AS DATA_INI_AFAST,
       B.DATA_FIM AS DATA_FIM_AFAST,
       B.COD_CAUSA_AFAST,
       CASE
         WHEN B.DATA_INICIO IS NOT NULL AND B.DATA_FIM IS NOT NULL THEN
          B.COD_CAUSA_AFAST || ' - ' || B.NOME_CAUSA_AFAST
         ELSE
          NULL
       END AS CAUSA_AFASTAMENTO,
       NVL(B.COD_CAUSA_AFAST, 0) AS COD_STATUS_AFAST,
       CASE
         WHEN A.DATA_FIM IS NOT NULL AND A.DATA_FIM < SYSDATE THEN
          'INATIVO'
         WHEN B.COD_CAUSA_AFAST <> 0 AND B.COD_CAUSA_AFAST <> 4 AND
              B.DATA_FIM = TO_DATE('31/12/2999', 'DD/MM/YYYY') THEN
          'AFASTADO'
         WHEN B.COD_CAUSA_AFAST = 7 THEN
          'EM FÉRIAS'
         WHEN B.COD_CAUSA_AFAST IN (3, 6) THEN
          'AFASTADO TEMP'
         WHEN B.COD_CAUSA_AFAST = 4 AND
              B.DATA_FIM = TO_DATE('31/12/2999', 'DD/MM/YYYY') THEN
          'PODERÁ RETORNAR'
         ELSE
          'EM ATIVIDADE'
       END AS STATUS_AFAST
  FROM RHFP0300 A
 INNER JOIN PESSOA_FISICA PF ON A.COD_FUNC = PF.COD_PESSOA
 INNER JOIN RHFP0310 CT ON A.COD_CONTRATO = CT.COD_CONTRATO
                       AND CT.DATA_FIM =
                           TO_DATE('31/12/2999', 'DD/MM/YYYY')
 INNER JOIN RHFP0401 O ON CT.COD_ORGANOGRAMA = O.COD_ORGANOGRAMA
  LEFT JOIN V_AFAST_COLAB_AVT B ON A.COD_CONTRATO = B.COD_CONTRATO

--FILTROS NÃO USADOS
/*WHERE TRUNC(SYSDATE) BETWEEN A.DATA_INICIO AND A.DATA_FIM*/
/*(A.DATA_FIM IS NULL OR A.DATA_FIM >= TRUNC(SYSDATE) OR
       A.DATA_FIM < TRUNC(SYSDATE))
   AND (A.DATA_INICIO <= TRUNC(SYSDATE) OR A.DATA_INICIO > TRUNC(SYSDATE))*/

 ORDER BY STATUS ASC, DESC_STATUS DESC, A.COD_CONTRATO ASC

