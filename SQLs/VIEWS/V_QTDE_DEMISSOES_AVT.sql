CREATE OR REPLACE VIEW V_QTDE_DEMISSOES_AVT AS
SELECT
    --A.COD_CONTRATO,
    TO_CHAR(A.DATA_RESCISAO, 'MM/YYYY') AS DATA_RESCISAO, -- Extrai o mês e ano
    B.COD_EMP,
    B.COD_TIPO,
    B.COD_UNIDADE,
    B.COD_REDE,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 10 THEN 1 END) AS DEMISSAO_COD_10,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 11 THEN 1 END) AS DEMISSAO_COD_11,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 12 THEN 1 END) AS DEMISSAO_COD_12,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 13 THEN 1 END) AS DEMISSAO_COD_13,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 14 THEN 1 END) AS DEMISSAO_COD_14,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 15 THEN 1 END) AS DEMISSAO_COD_15,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 20 THEN 1 END) AS DEMISSAO_COD_20,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 21 THEN 1 END) AS DEMISSAO_COD_21,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 30 THEN 1 END) AS DEMISSAO_COD_30,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 31 THEN 1 END) AS DEMISSAO_COD_31,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 32 THEN 1 END) AS DEMISSAO_COD_32,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 33 THEN 1 END) AS DEMISSAO_COD_33,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 34 THEN 1 END) AS DEMISSAO_COD_34,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 35 THEN 1 END) AS DEMISSAO_COD_35,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 40 THEN 1 END) AS DEMISSAO_COD_40,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 41 THEN 1 END) AS DEMISSAO_COD_41,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 42 THEN 1 END) AS DEMISSAO_COD_42,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 50 THEN 1 END) AS DEMISSAO_COD_50,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 60 THEN 1 END) AS DEMISSAO_COD_60,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 62 THEN 1 END) AS DEMISSAO_COD_62,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 63 THEN 1 END) AS DEMISSAO_COD_63,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 64 THEN 1 END) AS DEMISSAO_COD_64,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 70 THEN 1 END) AS DEMISSAO_COD_70,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 71 THEN 1 END) AS DEMISSAO_COD_71,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 72 THEN 1 END) AS DEMISSAO_COD_72,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 73 THEN 1 END) AS DEMISSAO_COD_73,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 74 THEN 1 END) AS DEMISSAO_COD_74,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 75 THEN 1 END) AS DEMISSAO_COD_75,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 76 THEN 1 END) AS DEMISSAO_COD_76,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 78 THEN 1 END) AS DEMISSAO_COD_78,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 79 THEN 1 END) AS DEMISSAO_COD_79,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 80 THEN 1 END) AS DEMISSAO_COD_80,
    COUNT(CASE WHEN A.COD_CAUSA_DEMISSAO = 99 THEN 1 END) AS DEMISSAO_COD_99,
    COUNT(DISTINCT A.COD_CONTRATO) AS TOTAL_DEMISSOES
FROM
    RHFP0350 A
LEFT JOIN VH_EST_ORG_CONTRATO_AVT B
  ON A.COD_CONTRATO = B.COD_CONTRATO
 AND A.DATA_RESCISAO BETWEEN B.DATA_INI_ORG AND B.DATA_FIM_ORG
WHERE B.COD_EMP IN (8, 276, 282, 1629)
--AND C.COD_REDE = '001'
--AND A.DATA_RESCISAO BETWEEN '01/07/2025' AND '31/07/2025'
GROUP BY
    --A.COD_CONTRATO,
    TO_CHAR(A.DATA_RESCISAO, 'MM/YYYY'),
    B.COD_EMP,
    B.COD_TIPO,
    B.COD_UNIDADE,
    B.COD_REDE
ORDER BY DATA_RESCISAO

